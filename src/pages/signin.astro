---
import { supabase } from "~/lib/supabase";
import Layout from "../layouts/Layout.astro";

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

const {data, error} = await supabase.auth.getUser();
console.log(data, error);
if(data.user !== null) {
  return redirect("/");
}

if (accessToken && refreshToken) {
  return redirect("/account");
}
---

<Layout title="Sign in">
  <div class="flex flex-col min-h-screen justify-center items-center">

    <div class="h-56 lg:w-72 w-56 lg:h-72 fixed bg-[#00ADB5] rounded-full -z-50 opacity-30 lg:-bottom-10 lg:-left-10 -bottom-8 -left-8" transition:name="blobA"></div>
    <div class="h-56 lg:w-72 w-56 lg:h-72 bg-[#00ADB5] rounded-full -z-50 opacity-30 lg:top-0 top-4 -right-8 fixed" transition:name="blobB"></div>
    
    <div class="bg-white py-4 px-8 w-3/4 max-w-lg rounded-lg shadow-lg">
      <h1 class="my-4">Sign in</h1>
      <form action="/api/auth/signin" method="post">
        <div class="flex flex-col gap-6">
  
          <div class="flex flex-col">
            <label for="email" for="email">Email</label>
            <input type="email" name="email" id="email" class="rounded-lg py-2 px-4 border-gray-300 border shadow-md transition-all ease-out duration-300
            focus:outline-none focus:ring-2 focus:ring-[#00ADB5]"/>
          </div>
  
          <div class="flex flex-col">
            <label for="password">Password</label>
            <input type="password" name="password" id="password" class="rounded-lg py-2 px-4 border-gray-300 border shadow-md transition-all ease-out duration-300
            focus:outline-none focus:ring-2 focus:ring-[#00ADB5]"/>
          </div>
          <button type="submit" class="bg-[#00ADB5] py-2 rounded-xl text-white font-semibold transition-colors ease-in-out duration-300 text-lg
          hover:bg-[#00acb5c2] focus:bg-[#00acb5c2] focus:outline-none focus:ring-2 focus:ring-gray-200">
            Login
          </button>
        </div>
      </form>
      <p class="flex mt-2">New here? <a href="/register" class="text-blue-500 underline ml-2">Create an account</a></p>
    </div>
  </div>

</Layout>